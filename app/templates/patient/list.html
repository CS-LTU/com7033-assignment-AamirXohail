{% extends "base.html" %}
{% block content %}

<h2 class="mb-4">Patient records</h2>

<form method="GET" class="row mb-3">
    <div class="col-md-4">
        <input type="text" name="q" class="form-control"
               placeholder="Search by Patient ID"
               value="{{ search_query or '' }}">
    </div>
    <div class="col-md-2">
        <button class="btn btn-secondary w-100">Search</button>
    </div>
    <div class="col-md-6 text-end">
        <a href="{{ url_for('patient.add_patient') }}" class="btn btn-success">
            Add new patient
        </a>
    </div>
</form>

<div class="table-responsive">
    <table class="table table-striped table-hover bg-white shadow-sm">
        <thead class="table-light">
            <tr>
                <th>Patient ID</th>
                <th>Gender</th>
                <th>Age</th>
                <th>Hypertension</th>
                <th>Heart disease</th>
                <th>Stroke</th>
                <th style="width: 230px;">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for p in patients %}
            <tr>
                <td>{{ p.patient_id or p.get("patient_id") or "N/A" }}</td>
                <td>{{ p.gender or p.get("gender") }}</td>
                <td>{{ p.age or p.get("age") }}</td>
                <td>{{ "Yes" if (p.hypertension or p.get("hypertension")) == 1 else "No" }}</td>
                <td>{{ "Yes" if (p.heart_disease or p.get("heart_disease")) == 1 else "No" }}</td>
                <td>
                    {% set stroke_value = p.stroke or p.get("stroke") %}
                    {% if stroke_value == 1 %}
                        <span class="badge bg-danger">Stroke</span>
                    {% else %}
                        <span class="badge bg-success">No stroke</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('patient.view_patient', patient_id=p['_id']) }}"
                           class="btn btn-sm btn-info text-white">View</a>
                        <a href="{{ url_for('patient.edit_patient', patient_id=p['_id']) }}"
                           class="btn btn-sm btn-warning">Edit</a>

                        <form action="{{ url_for('patient.delete_patient', patient_id=p['_id']) }}"
                              method="POST" style="display:inline-block;"
                              onsubmit="return confirm('Delete this patient?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button class="btn btn-sm btn-danger">Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="7" class="text-center text-muted">
                    No patient records yet.
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

{% endblock %}
